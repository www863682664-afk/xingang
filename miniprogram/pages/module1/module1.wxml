<view class="container">
  <view class="tabs">
    <view class="tab {{type==='repair'?'active':''}}" bindtap="switchType" data-type="repair">维修清单</view>
    <view class="tab {{type==='maintenance'?'active':''}}" bindtap="switchType" data-type="maintenance">保养清单</view>
  </view>

  <view class="card">
    <view class="form-group">
      <text class="label">维修车辆</text>
      <input class="input" placeholder="请输入车牌号" value="{{vehicle}}" bindinput="inputVehicle" />
    </view>
    
    <view class="form-group">
      <text class="label">维修单位</text>
      <input class="input" placeholder="请输入维修单位" value="{{repairUnit}}" bindinput="inputRepairUnit" />
    </view>

    <view class="form-group">
      <text class="label">维修地点</text>
      <input class="input" placeholder="请输入维修地点" value="{{repairLocation}}" bindinput="inputRepairLocation" />
    </view>
  </view>

  <view class="card">
    <view class="table-header">
      <text class="section-title">维修项目清单</text>
    </view>
    <view class="table">
    <view class="tr th">
      <view class="col-name th">项目</view>
      <view class="col-qty th">数量</view>
      <view class="col-unit th">单位</view>
      <view class="col-price th">单价</view>
      <view class="col-labor th">工费</view>
      <view class="col-spec th">规格</view>
      <view class="col-action th">删</view>
    </view>
    <block wx:for="{{items}}" wx:key="index">
      <view class="tr">
        <view class="td col-name"><input value="{{item.name}}" data-index="{{index}}" data-field="name" bindinput="inputItem" placeholder="名称"/></view>
        <view class="td col-qty"><input type="number" value="{{item.quantity}}" data-index="{{index}}" data-field="quantity" bindinput="inputItem" placeholder="1"/></view>
        <view class="td col-unit">
          <picker bindchange="onUnitChange" data-index="{{index}}" range="{{unitOptions}}">
             <view class="picker-inner" style="width: 100%; height: 100%; min-height: 50rpx; display: flex; align-items: center; justify-content: center; font-size: {{item.customUnitEnabled ? '20rpx' : '24rpx'}};">{{item.customUnitEnabled ? '▼' : (item.unit || '选')}}</view>
          </picker>
          <input wx:if="{{item.customUnitEnabled}}" value="{{item.customUnit}}" data-index="{{index}}" bindinput="onUnitInput" placeholder="输入单位" style="flex: 1; margin-left: 5rpx; text-align: center; border-bottom: 1px solid #ccc;" />
        </view>
        <view class="td col-price"><input type="digit" value="{{item.price}}" data-index="{{index}}" data-field="price" bindinput="inputItem" placeholder=""/></view>
        <view class="td col-labor"><input type="digit" value="{{item.laborCost}}" data-index="{{index}}" data-field="laborCost" bindinput="inputItem" placeholder=""/></view>
        <view class="td col-spec"><input value="{{item.spec}}" data-index="{{index}}" data-field="spec" bindinput="inputItem" placeholder="规格"/></view>
        <view class="td col-action" bindtap="deleteRow" data-index="{{index}}">×</view>
      </view>
      <view class="tr sum-row">
        <text>小计: {{item.subtotal}}</text>
      </view>
    </block>
  </view>

    <view class="action-bar">
      <button class="btn btn-add" bindtap="addRow">+ 添加项目</button>
    </view>
    
    <view class="total-bar">
      <text>合计金额: <text class="amount">¥{{totalAmount}}</text></text>
    </view>
  </view>

  <view class="footer-action">
    <button class="btn btn-primary" bindtap="submitForm">导出 PDF</button>
  </view>
</view>
